Ext.ns("Ext.ux");Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:!0,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:!0,beforedragover:!0,dragover:!0,beforedrop:!0,drop:!0})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){this.dd&&this.dd.unreg();Ext.ux.Portal.superclass.beforeDestroy.call(this)}});
Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig};
Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:!0,increment:200},createEvent:function(a,b,h,e,c,f){return{portal:this.portal,panel:h.panel,columnIndex:e,column:c,position:f,data:h,source:a,rawEvent:b,status:this.dropAllowed}},notifyOver:function(a,b,h){var e=b.getXY(),c=this.portal,f=a.proxy;if(!this.grid)this.grid=this.getGrid();var d=c.body.dom.clientWidth;if(this.lastCW){if(this.lastCW!=d)this.lastCW=d,c.doLayout(),this.grid=this.getGrid()}else this.lastCW=
d;for(var d=0,i=this.grid.columnX,g=!1,l=i.length;d<l;d++)if(e[0]<i[d].x+i[d].w){g=!0;break}g||d--;for(var j,i=!1,g=0,k=c.items.itemAt(d),n=k.items.items,m=!1,l=n.length;g<l;g++){j=n[g];var o=j.el.getHeight();if(o===0)m=!0;else if(j.el.getY()+o/2>e[1]){i=!0;break}}g=(i&&j?g:k.items.getCount())+(m?-1:0);a=this.createEvent(a,b,h,d,k,g);if(c.fireEvent("validatedrop",a)!==!1&&c.fireEvent("beforedragover",a)!==!1)f.getProxy().setWidth("auto"),j?f.moveProxy(j.el.dom.parentNode,i?j.el.dom:null):f.moveProxy(k.el.dom,
null),this.lastPos={c:k,col:d,p:m||i&&j?g:!1},this.scrollPos=c.body.getScroll(),c.fireEvent("dragover",a);return a.status},notifyOut:function(){delete this.grid},notifyDrop:function(a,b,h){delete this.grid;if(this.lastPos){var e=this.lastPos.c,c=this.lastPos.p,b=this.createEvent(a,b,h,this.lastPos.col,e,c!==!1?c:e.items.getCount());if(this.portal.fireEvent("validatedrop",b)!==!1&&this.portal.fireEvent("beforedrop",b)!==!1){a.proxy.getProxy().remove();a.panel.el.dom.parentNode.removeChild(a.panel.el.dom);
c!==!1?(e==a.panel.ownerCt&&e.items.items.indexOf(a.panel)<=c&&c++,e.insert(c,a.panel)):e.add(a.panel);e.doLayout();this.portal.fireEvent("drop",b);var f=this.scrollPos.top;if(f){var d=this.portal.body.dom;setTimeout(function(){d.scrollTop=f},10)}}delete this.lastPos}},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:!0,collapsible:!0,draggable:!0,cls:"x-portlet",listeners:{afterrender:function(){var a=this.getEl().id,b=this.getEl().getHeight(),h=this;this.resizeWrap=new Ext.Resizable(a,{handles:"s",height:b,minHeight:50,dynamic:!0,listeners:{resize:function(a,b,f){h.setHeight(f);MixkyApp.getSubject(h.key).webheight=f}}})},beforedestroy:function(){delete this.resizeWrap}}});Ext.reg("portlet",Ext.ux.Portlet);
