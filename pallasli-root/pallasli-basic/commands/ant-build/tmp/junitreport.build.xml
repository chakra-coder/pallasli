<?xml version="1.0"?>

 <project name="ant" default="report" basedir="." >   
	<property name="jar.filename" value="${src.jar.filename}"/>
	<!--项目上下文路径-->
	<property name="classes.dir" value="${src.classes.dir}"/>
	<property name="dist.dir" value="${src.dist.dir}"/>
      <property name="java.dir" location="src/test/java" />   
     <property name="target.dir" location="target"></property>   
      <property name="target.report.dir" location="${target.dir}/report"></property>   
      <property name="target.classes.java.dir" location="${target.dir}/classes/java"></property>   
      <property name="target.classes.test.dir" location="${target.dir}/classes/test"></property>   
   
            <target name = "clear">
               <delete includeemptydirs="true">
                  <fileset dir="target" includes="**/*"/>
               </delete>
            </target>
            
	<property name="lib" value="lib"/>
    <path id="project.class.path">
        <fileset dir="${lib}">
            <include name="*.jar"/>
        </fileset>
        <pathelement location="${bin}"/>
        <pathelement path="${java.class.path}" />
    </path>
    
     <target name="compile.java">   
         <mkdir dir="${target.classes.java.dir}"/>   
         <javac destdir="${target.classes.java.dir}"  includeantruntime="on">   
             <src path="${java.dir}"></src>   
             <classpath refid="project.class.path" />  
         </javac>   
     </target>

     
     <target name="compile.test" depends="compile.java">   
         <mkdir dir="${target.classes.test.dir}"/>   
         <javac destdir="${target.classes.test.dir}"   includeantruntime="on">   
             <src path="${java.dir}"/>    
    
             <classpath>   
		        <fileset dir="${lib}">
		            <include name="*.jar"/>
		        </fileset>
				<pathelement location="${target.classes.java.dir}"/>   
             </classpath>   
         </javac>   
     </target> 

            <target name="jar" description="o Create the jar" depends="compile.java,compile.test">
                 <jar destfile="${target.dir}/jar/Test.jar" basedir="${target.classes.test.dir}"   excludes="**/Test.class" />
           </target>


     <target name="compile" depends="compile.java,compile.test,jar"></target>  

     <target name="test" depends="compile">   
         <mkdir dir="${target.report.dir}"/>   
  
         <property name="tests" value="Test*"/>   
         
         <junit printsummary="yes" haltonerror="yes" haltonfailure="yes" fork="yes">    
            
                     <formatter type="xml"/>   
          
             <batchtest todir="${target.report.dir}">  
                 <fileset dir="${target.classes.test.dir}">   
                     <include name="**/Test*.class"/>
                            <include name="**/*Test.class"/>  
                            <exclude name="**/*AllTest.class"/>  
                 </fileset>   
             </batchtest>   
            
             <classpath>   
		        <fileset dir="${lib}">
		            <include name="*.jar"/>
		        </fileset> 
                 <pathelement location="${target.classes.java.dir}"/>   
                 <pathelement location="${target.classes.test.dir}"/>   
            </classpath>   
         </junit>   
     </target>  

     <target name="report" depends="test">   
         <mkdir dir="${target.report.dir}/html"/> 
                
        
         <junitreport todir="${target.report.dir}">   
             <fileset dir="${target.report.dir}"> 
                 <include name="TEST-*.xml"/> 
                         
             </fileset>   
             <report format="frames"  todir="${target.report.dir}/html"/>   
         </junitreport>   
     </target>   
        
 </project>